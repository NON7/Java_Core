# 1.进程的概念和特征

### 1.进程的概念

##### 进程控制块（PCB）：

- 目的：为了使参与并发执行的程序能独立的运行，必须为之配置一个专门的数据结构，称为进程控制块；
- 作用：系统用PCB来描述进程的基本情况和运行状态，进而控制和管理进程；
- 意义：PCB是进程存在的唯一标志；

##### 进程映像（进程实体）：

- 组成：程序段+数据段+PCB；

##### 进程与进程映像的比较

- 创建进程=创建进程映像中的PCB；
- 撤销进程=撤销进程映像中的PCB；
- 进程是动态的，进程映像是静态的；

##### 进程的定义

1. 进程是程序的一次执行过程；
2. 进程是一个程序及其数据在处理机上顺序执行时所发生的的活动；
3. 进程是具有独立功能的程序在一个数据集合上运行的过程，它是系统进行资源分配和调度的一个独立单位；
4. 进程是进程实体的运行过程，是系统进行资源分配和调度的独立单位；

### 2.进程的特征

- #### 动态性：进程的基本特征

- #### 并发性

- #### 独立性

- #### 异步性

- #### 结构性





# 2.进程的状态与转换

### 1.状态

- #### 运行状态：进程正在处理机上运行，单处理机环境下，每一时刻最多只有1个进程处于运行状态；

- #### 就绪状态：进程已处于准备运行的状态，即进程获得了除处理机外的一切所需资源，一旦得到处理机即可运行；<a font="red">缺少处理机</a>

- #### 阻塞状态（等待状态）：进程正在等待某一事件而暂停运行，处理机空闲，也不能运行；<a font="red">缺少运行资源</a>

- #### 创建状态：进程正在被创建，未转到就绪状态（申请空白PCB->向PCB写入控制和管理进程信息->系统为该进程分配运行时所必须的资源->进程转入就绪状态）；

- #### 结束状态：进程正从系统中消失，可能是正常结束或中断退出运行，进程结束运行时，系统必须先将其置为结束状态，然后再处理资源释放和回收；

### 2.状态转换

- #### 就绪->运行：处于就绪状态的进程被调度后，获得处理机资源（分派处理机时间片），于是进程有就绪转为运行；

- #### 运行->就绪：处于运行状态的进程在时间片用完后，不得不让出处理机，从而进程从运行转为就绪；此外在可剥夺的操作系统中，当有更高优先级的进程就绪时，调度程序将正执行的进程转换为就绪状态，让更高优先级的进程执行；

- #### 运行->阻塞：当进程请求某一资源的使用和分配或等待某一时间的发生时，从运行转为阻塞，进程以系统调用的形式请求操作系统提供服务，这是一种特殊的，由运行用户态程序调用操作系统内核过程的形式；<a font="red">主动行为</a>

- #### 阻塞->就绪：当进程等待的事件到来时，中断处理程序必须把相应的进程状态由阻塞转换为就绪；<a font="red">被动行为，需要其他相关进程的协助</a>





# 3.进程控制

> <a font="red">`原语：进程控制用的程序段称为原语，原语的特点是执行期间不允许中断，它是一个不可分割的基本单位`</a>

### 1.进程的创建（创建原语）

> 允许一个进程创建另一个进程，此时创建者称为父进程，被创建者称为子进程，子进程可以继承父进程所拥有的资源，当子进程被撤销时，应将其从父进程那里获得的资源归还给父进程，此外，在父进程被撤销时，也必须同时撤销其所有子进程

- #### 第一步：申请	

  - 为新进程分配一个唯一的进程标识号，并申请一个空白的PCB（PCB是有限的），若PCB申请失败则创建失败；

- #### 第二步：分配资源

  - 为新进程的程序和数据，以及用户栈分配必要的内存空间（在PCB中体现），注意：这里如果资源不足（内存不够），并不是创建失败，而是处理等待状态，或者称为阻塞状态，等待的是内存这个资源

- #### 第三步：初始化PCB(主要包括一下内容)

  - 初始化标志信息
  - 初始化处理机状态信息
  - 初始化处理机控制信息
  - 设置进程的优先级

- #### 第四步：状态转换

  - 如果进程就绪队列能够接纳新进程，就将新进程插入到就绪队列，等待被调度运行

### 2.进程的终止(撤销原语)

> 引起进程终止的事件主要有：
>
> 正常结束：表示进程的任务已经完成和准备退出运行；
>
> 异常结束：表示进程在运行时，发生了某种异常事件，使程序无法继续运行，如存储区越界，保护错，非法指令，特权指令错，I/O故障等；
>
> 外界干预：进程应外界的请求而终止运行，如操作员或操作系统干预、父进程请求和父进程终止

- #### 第一步：读PCB状态

  - 根据被终止进程的标识符，检索PCB，从中读出该进程的状态；

- #### 第二步：运行态进程终止

  - 若被终止进程处于执行状态，立即终止该进程的执行，将处理机资源分配给其他进程；

- #### 第三步：子进程终止

  - 若该进程还有子进程，则应将其所有子进程终止

- #### 第四步：资源归还

  - 将该进程所拥有的的全部资源，归还其父进程或操作系统

- #### 第五步：PCB删除

  - 将该PCB从所在队列（链表）中删除

### 3.进程的阻塞和唤醒

#### 3.1 进程阻塞（阻塞原语）

> 正在执行的进程，由于期待的某些事件未发生，如请求系统资源失败，等待某种操作的完成、新数据尚未到达或无新工作可做等，则由系统自动执行阻塞原语（Block），使自己由运行状态变为阻塞状态。可见进程的阻塞时进程自身的一种主动行为，也因此只有处于运行态的进程（获得CPU）才可能将其转为阻塞状态

- #### 第一步：找到要被阻塞的PCB

  - 找到将要被阻塞进程的标识号对应的PCB；

- #### 第二步：状态转换

  - 若该进程为运行状态，则保护其现场，将其状态转换为阻塞状态，停止运行

- #### 第三步：PCB插入等待队列

  - 把该PCB插入到对应事件的等待队列中去；

#### 3.2 进程唤醒（唤醒原语）

> 当被阻塞进程所期待的事件出现时，如它所启动的I/O操作已完成或其所期待的数据已到达，则由有关进程（比如，提供数据的进程）调用唤醒原语，将等待该事件的进程唤醒

- #### 第一步：找到PCB

  - 在该事件的等待队列中找到相应进程的PCB

- #### 第二步：PCB删除，进程状态转换

  - 将其从等待队列中移出，并置其状态为就绪状态

- #### 第三步：PCB插入就绪队列

  - 把该PCB插入就绪队列中，等待调度程序调度

> <a font="red">Block原语和Wakeup原语是一对作用刚好相反的原语，必须成对使用，Block原语是由被阻塞进程自我调用实现的，而Wakeup原语则是由一个与被唤醒进程相合作或被其他相关的进程调用实现的</a>

### 4.进程切换

> ​	对于通常的进程，其创建、撤销以及要求由系统设备完成的I/O操作都是利用系统调用而进入内核，再由内核中相应处理程序予以完成的。进程切换同样是在内核的支持下实现的，因此可以说任何进程都是在操作系统内核的支持下运行的，是与内核紧密相关的
>
> ​	进程切换是指处理机从一个进程的运行转到另一个进程上运行，这个过程中，进程的运行环境产生了实质性的改变

- #### 第一步：保存现场

  - 保存处理机上下文，包括程序计数器和其他寄存器

- #### 第二步：更新PCB

  - 更新PCB信息

- #### 第三步：PCB更换队列

  - ​	把进程的PCB移入相应的队列，如就绪、在某事件阻塞等队列

- #### 第四步：执行另一个进程

  - 选择另一个进程执行，并更新其PCB

- #### 第五步：更新数据结构

  - 更新内存管理的数据结构

- #### 第六步：恢复处理机上下文

  - 恢复处理机上下文

> <a font="red">进程切换与处理机模式切换是不同的：</a>
>
> <a font="red">模式切换：处理机逻辑上可能还在同一进程中运行。如果进程因终端或异常进入到核心态运行，执行完后又回到用户态刚被终端的程序运行，则操作系统只需要恢复进程进入内核时所保存的CPU线程，无需改变当前进程的环境信息</a>
>
> <a font="red">切换进程：当前运行进程改变了，则当前进程的环境信息也需要改变</a>

> <a font="red">注意“调度”和“切换”的区别</a>
>
> <a font="red">调度：指决定资源分配给哪个进程的行为，是一种角色行为；</a>
>
> <a font="red">切换：值实际分配的行为，是执行行为</a>
>
> <a font="red">一般来说，现有资源的调度，然后才有进程的切换</a>





# 4.进程的组织

### 1.进程控制块（PCB）

- #### PCB的生命周期

  - 进程创建：
  - 进程运行：
  - 进程结束：

- #### PCB包含内容

  - 包含内容

    - | 进程描述信息      | 进程控制和管理信息 | 资源分配清单 | 处理机相关信息   |
      | ----------------- | ------------------ | ------------ | ---------------- |
      | 进程标识符（PID） | 进程当前状态       | 代码段指针   | 通用地址寄存器值 |
      | 用户标识符（UID） | 进程优先级         | 数据段指针   | 地址寄存器值     |
      |                   | 代码运行入口地址   | 堆栈段指针   | 控制寄存器值     |
      |                   | 程序的外存地址     | 文件描述符   | 标志寄存器值     |
      |                   | 进入内存时间       | 键盘         | 状态字           |
      |                   | 处理机占用时间     | 鼠标         |                  |
      |                   | 信号量使用         |              |                  |

      

  - 进程描述信息

    - 进程标识符：标志各个进程，每个进程都有一个并且是唯一的标识号
    - 用户标识符：进程归属用户，用户标识符主要为共享和保护服务

  - 进程控制和管理信息

    - 进程当前状态：描述进程的状态信息，作为处理及分配调度的依据
    - 进程优先级：描述进程抢占处理机的优先级，优先级高的进程可以优先获得处理机

  - 资源分配清单

    - 用于说明有关内存地址空间或虚拟地址空间的状况，所打开文件的列表和所使用的输入/输出设备信息

  - 处理机相关信息

    - 主要指处理机中各寄存器值，当进程被切断时，处理机状态信息都必须保存在相应的PCB中，以便在该进程重新执行时，能再从断点继续执行

> ​	在一个系统中，通常存在着许多进程，有的处于就绪状态，有的处于阻塞状态，而阻塞的原因各不相同，为了方便进程的调度和管理，需要将各进程的PCB用适当的方法组织起来。目前常用的组织方式有链接方式和索引方式两种；
>
> ​	链接方式：将同一状态的PCB链接成一个队列，不同状态对应不同队列，也可以吧处于阻塞状态的进程的PCB，根据其阻塞原因的不同，排成多个阻塞队列
>
> ​	索引方式：将同一状态的进程组织在一个索引表中，索引表的表项指向相应的PCB，不同状态对应不同的索引表，如就绪索引表和阻塞索引表等

### 2.程序段

能被进程调度程序调度到CPU执行的程序代码段。

> <a font="red">程序可以被多个进程共享，就是说多个进程可以运行同一个程序</a>

### 3.数据段

一个进程的数据段，可以是进程对应的程序加工处理的原始数据，也可以是程序执行时产生的中间或最终结果





# 5.进程的通信

> 进程通信指进程之间的信息交换吗。PV操作时低级通信方式，高级的通信方式是指以较高的效率传输大量数据的通信方式。高级通信方式主要有以下三类
>
> 1.共享存储
>
> 2.消息传递
>
> 3.管道通信

### 1.共享存储

![](F:\user\desktop\笔记\操作系统\王道\img\1.PNG)





### 2.消息传递

### 3.管道通信

# 6.线程的概念和多线程模型

### 1.线程的基本概念

### 2.线程与进程的比较

- #### 调度

- #### 拥有资源

- #### 并发性

- #### 系统开销

- #### 地址空间和其他资源

- #### 通信方面

### 3.线程的属性

### 4.线程的实现方式

### 5.多线程模型

- #### 多对一模型

- #### 一对一模型

- #### 多对多模型